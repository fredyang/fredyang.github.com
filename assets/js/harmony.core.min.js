/*! Harmony v0.1pre Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(g,C,u){function Da(c,b){for(var a in b)c[a]||(c[a]=b[a])}function cb(c){return"."===c?"#":(new ma(c.length+2)).join("#")}function Ea(c){if(c===z)return"";var b=Fa.exec(c);return b?b[1].replace(na,oa):c}function oa(c){return"#"==c?".":(new ma(c.length)).join("#")}function pa(c,b,a){var d,e=c.lastIndexOf(".");j(a)&&(a=!0);if(a){-1===e?(a="",d=c):(a=c.substring(0,e),d=c.substring(e+1));e=a;a=d;for(var f=0;f<M.length;f++)M[f](e,a,b)}if(!Y(b))for(d in b){e=c;a=d;for(var f=b[d],k=0;k<M.length;k++)M[k](e,
a,f);pa(c+"."+d,b[d],!1)}}function Ga(c,b){b=A(b);var a=D[b];a||(D[b]=a=[]);a.pushUnique(c)}function Ha(c,b){b=A(b);var a=D[b];a.remove(c);a.length||delete D[b]}function Ia(c){return(c=db.exec(c))&&c[1]||""}function ca(){return!1}function B(){return!0}function da(c,b,a,d,e){this.publisher=E(c);this.originalPublisher=E(b);this.originalType=this.type=a;this.proposed=d;this.removed=e}function Ja(c){var b=c.workflow,a=b.getName,b=b.getParas;c=c.publisher;return b?c[a](b):n(c[a])?c[a]():c[a]}function Ka(c,
b){var a=b.workflow,d=a.setName;(a=a.setParas)?this[d](a,c):n(this[d])?this[d](c):this[d]=c}function La(c,b,a){var d=N.getId(b);return g.map(c.split(O),function(b){return l(a)?b+"."+z+"."+d+"."+a:b+"."+z+"."+d+"."+N.getId(a)}).join(" ")}function E(c){return l(c)?h(c):c==P?null:t(c)&&!c.nodeType?c:g(c)}function eb(c){return"."==c?"\\.":".*"}function Ma(c){var b,a,d;d=c.publisher.subsToMe();for(a=0;a<d.length;a++){b=d[a];var e=c,f;a:{f=b.eventTypes;var k=c.type,g=void 0,h=void 0,j=h=g=void 0,l=void 0;
if("*"===f)f="*";else{f=f.split(O);for(l=0;l<f.length;l++)if(h=f[l],h=(j=Na.test(h))?h.replace(Na,""):h,h=h.replace(fb,eb),h=j?"^"+h:"^"+h+"$",g=new K(h),g=g.test(k))if(j){if(j="^"==h?k:K.rightContext,!j||!j.contains(".")){f=f[l];break a}}else{f=f[l];break a}f=void 0}}e.matchedType=f;c.matchedType&&ea(E(b.subscriber),b.workflow,c);if(c.isImmediatePropagationStopped())return}if(!c.isCascadeStopped()&&(b=D[c.publisher.path]))for(d=0;d<b.length;d++){a=s(b[d],c.originalPublisher.path,c.type);if(a.isImmediatePropagationStopped()||
a.isImmediatePropagationStopped())break;a.hasError()&&c.error()}}function ea(c,b,a,d){var e;a.workflow=b;a.subscriber=c;d=j(d)?b.get.call(c,a):b.get.apply(c,[a].concat(d));Z(d)?(e=m(!0,{},a),d.done(function(d){b.convert&&(d=b.convert.call(c,d,a));if(!j(d))if(Z(d))d.done(function(a){fa(c,b,a,e)});else return fa(c,b,d,a)})):(b.convert&&(d=b.convert.call(c,d,a)),j(d)||(Z(d)?(e=m(!0,{},a),d.done(function(a){fa(c,b,a,e)})):fa(c,b,d,a)))}function fa(c,b,a,d){j(a)||(b.set&&b.set.call(c,a,d),b.finalize&&
b.finalize.call(c,a,d))}function Q(c){c.publisher=E(c.currentTarget);c.originalPublisher=E(c.target);var b=E(c.data.subscriber),a=c.data.workflow;delete c.data;1<arguments.length?ea(b,a,c,r.call(arguments,1)):ea(b,a,c)}function Oa(c,b,a,d){c=c||"";if(l(c)){var e,f=c.split(O),k;if(1==f.length)if(c.startsWith("*")){e=R[c.substr(1)];if(!e)throw"common workflow "+c+" does not exist";e=m({},e)}else if(c.startsWith("#")?(e=c.substr(1),e=l(a)?x(a,e):l(b)?x(b,e):e,e=p.raw(e)):e=void 0,e)if(n(e))e=m({get:e,
options:d},e);else if(t(e)&&e.get)e=m({options:d},e);else throw"missing handler";else if(!j(b)&&!j(a)){e=l(b);f=l(a);if(e)c={get:"get",set:c||"set"};else if(f)if(c)c={get:c,set:"set"};else if(c=p.raw(a),n(c))c={get:p.raw(a)};else{if(!t(c)||!c.get)throw"missing handler";}else c={get:c,set:c};e=c}else throw"invalid handler";else{e={};for(var g=0;g<ga.length;g++)c=f[g],k=ga[g],c&&("_"!==c&&"null"!=c)&&(e[k]=c)}c=e}else if(n(c))c=m({get:c,options:d},c);else if(t(c)&&c.get)c=m({options:d},c);else throw"invalid workflow expression";
e=c;f=e.initialize;if(l(f))if(f.startsWith("*")){if(f=h.activity.initialize[f.substring(1)],!f)throw"initialize activity does not exist!";}else{var ra=f;if(!p.raw(ra))throw"initialize activity does not exist at path "+ra;f=function(a,b,c,d){p.set(ra,a,b,c,d)}}f?(f(E(b),E(a),e,d),delete e.initialize):j(d)||(e.options=d);ha("get",c,b,a);ha("set",c,b,a);$(c,"convert");$(c,"finalize");return c}function Pa(c){var b;if(l(c)){var a=c.split(O),d;if(1<a.length){c={};for(var e=0;e<ga.length;e++)b=a[e],d=ga[e],
b&&("_"!==b&&"null"!=b)&&(c[d]=b)}else throw"invalid workflow type";b=c}else if(n(c)||t(c)&&c.get)b=c,n(c)&&(b=m({get:c},b));else throw"invalid workflow expression";$(b,"initialize");ha("get",b);ha("set",b);$(b,"convert");$(b,"finalize");return b}function ha(c,b,a,d){var e=b[c];if(e&&l(e)){var f=h.activity[c];if(e.startsWith("*")){if(e=e.substr(1),b[c]=f[e],!b[c])throw e+" does not exists "+c+" Activity";}else if(e=e.split("*"),b[c]="get"==c?Ja:Ka,b[c+"Name"]=e[0],e[1]&&(b[c+"Paras"]=e[1]),!j(a)&&
!j(d)){b=e[0];a="get"==c?a:d;var k;l(a)?sa[b]||(k=!0):a.nodeType?S[b]||(k=!0):b in a||(k=!0);if(k)throw("get"==c?"publisher":"subscriber")+" does not have a member "+b;}}}function $(c,b){var a=c[b];if(l(a))if(a.startsWith("*")){if(c[b]=h.activity[b][a.substr(1)],!c[b])throw a+"Activity does not exists";}else c[b]=function(){return p.raw(a).apply(this,arguments)}}function Qa(c){if(t(c)){if(!N.getId(c))return;N.unMark(c)}y.removeBy(c)}function ta(c,b){if("_"!==b)return b&&b.startsWith("_")?b.substr(1):
c||b}function G(c,b,a,d){var e,f;if(c)if(c.nodeType){if(d=c,c=g.trim(g(d).attr(H.subsAttr))){b=new G;b.elem=d;a=b;a:{for(d=g(d);(d=d.parent())&&d.length;)if(e=d.hmData("ns"),!j(e)){d=e;break a}d=""}a.ns=d;return new G(c,b)}}else{if(!b)return b=new G,b.elem={},new G(c,b);this.sub=[];this.pub=[];for(this.groups=[];f=gb.exec(c);){var k=f[1],h=f[2];f=f[3];var l={key:h,value:f};k?this["$"==k?"pub":"sub"].push(l):"ns"==h?e=f:this.groups.push(l)}this.ns=x(x(b.ns,a),e);this.text=c;this.elem=b.elem;this.subscriptions=
b.subscriptions;b.elemGroup?this.elemGroup=b.elemGroup:(this.elemGroup=this,g(this.elem).hmData("ns",this.ns));this.options=ta(b.options,d);this.importGroup();this.importSubscriptions("sub");this.importSubscriptions("pub");this.debug&&this.print()}else this.subscriptions=[]}function ua(c){var b,a,d,e=g(c);if(!e.hmData("parsed")&&e.attr(H.subsAttr)){c=new G(c);b=c.subscriptions;c.preSub&&c.preSub();for(a=0;a<b.length;a++)d=b[a],h.sub(d.subscriber,d.publisher,d.eventTypes,d.handler,d.options,d.delegate);
c.postSub&&c.postSub();e.hmData("parsed",!0)}e.children().each(function(){ua(this)})}function Ra(c,b,a){return m({},va,t(c)?c:{get:c,set:b,finalize:a})}function Sa(c){this.modelPath=c.publisher.path;this.e=c}function Ta(c){c=c||T.defaultEngine;if(!c)throw"engine name is not specified or default engine name is null";c=ia[c];if(!c)throw"engine '"+c+"' can not be found.";return c}function Ua(c){c=c[0];return"true"==c.value?!0:"false"==c.value?!1:"on"!==c.value?c.value:c.checked}function Va(c,b,a,d){a:{var e,
f;if(a)for(e=U.length-1;0<=e;e--){if(f=U[e],f.name==a){a=f;break a}}else for(e=U.length-1;0<=e;e--)if(f=U[e],f.match&&f.match(c)){a=f;break a}a=void 0}if(!a||!a[d])throw"can not find "+d+" method for view";b[d+"ViewValue"]=a[d];a.convert&&(b.convert=a.convert);c.hmData("valueBound")||(a.initialize&&a.initialize(c),c.hmData("valueBound",!0))}var h=C.hm=function(c,b){return new wa(c,b)},wa=function(c,b){this.path=A(c||"",!0);j(b)||this.set(b)},aa=C.document,xa=C.localStorage,V=C.setTimeout,hb=C.alert,
ib=C.confirm,sa,m=g.extend,ya={},I=g.isArray,n=g.isFunction,jb={undefined:u,"boolean":u,number:u,string:u},z="__hm",Fa=/^__hm\.([^\.]+?)(?:\.|$)/,kb=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,D={},H={},p,ba=ya[z]={},lb=ya.hasOwnProperty,ma=C.Array,Wa=ma.prototype,mb=String.prototype,r=Wa.slice,s,nb=/^(?:\{.*\}|\[.*\])$/,ob=/^\.(\.*)([\.\*])/,pb=/^\.<(.*)/,Xa=/^[\.\*]/,qb=/[\.\*]/,rb=/#+|\./g,na=/#+/g,K=C.RegExp,db=/^(.+)[\.\*]\w+$/,x,sb=/^.+\.(\w+)$|\w+/,F,j,Y,l,t,W,za=g.isNumeric,Z,ja,A,
J,Ya,S=g.fn,tb=/\{([^\{\}]*)\}/g;Da(Wa,{indexOf:function(c,b){for(var a=b||0;a<this.length;a++)if(this[a]==c)return a;return-1},contains:function(c){return-1!==this.indexOf(c)},remove:function(c){c=this.indexOf(c);-1!=c&&this.splice(c,1);return this},removeAt:function(c){this.splice(c,1);return this},pushUnique:function(c){this.contains(c)||this.push(c);return this},merge:function(c){if(c&&c.length)for(var b=0;b<c.length;b++)this.pushUnique(c[b]);return this},sortObject:function(c,b){j(b)&&(j(c)?
(b=!0,c=u):l(c)?b=!0:(b=c,c=u));c?this.sort(function(a,d){var e=a[c],f=d[c];return e==f?0:b?e>f?1:-1:e>f?-1:1}):b?this.sort():this.sort().reverse();return this}});Da(mb,{startsWith:function(c){return 0===this.indexOf(c)},contains:function(c){return-1!==this.indexOf(c)},endsWith:function(c){return-1!==this.indexOf(c,this.length-c.length)},supplant:function(c){return this.replace(tb,function(b,a){var d=c[a];return typeof d?d:b})},format:function(){var c=this;g.each(arguments,function(b,a){c=c.replace(new K("\\{"+
b+"\\}","g"),a)});return c}});sa=wa.prototype=h.fn=h.prototype={constructor:wa,get:function(c){var b;if(b=this.accessor(c,!0)){if(n(b.hostObj))return b.hostObj.apply(this.cd(".."),r.call(arguments));b=!b.index?b.hostObj:b.hostObj[b.index];return n(b)?b.apply(this.cd(c).cd(".."),r.call(arguments,1)):b}},getJson:function(){return JSON.stringify(this.get.apply(this,r.call(arguments)))},raw:function(c,b){var a;n(c)&&(b=c,c="");if(b)return a=this.accessor(c),a.index in a.hostObj?this.update(c,b,a):this.create(c,
b,a);if(a=this.accessor(c,!0))return!a.index?a.hostObj:a.hostObj[a.index]},set:function(c,b,a){if(1==arguments.length){if(""===this.path)throw"root object can not changed";p.set(this.path,c,b);return this}var d=r.call(arguments);if(W(c)){if(2==arguments.length)return p.set(c,this.path,b),this}else a=b,b=c,c=!1;var e=this.accessor(b),f=e.hostObj[e.index];return n(f)?(f.apply(this.cd(b).cd(".."),r.call(d,1)),this):e.index in e.hostObj?this.update(c,b,a,e):this.create(c,b,a,e)},accessor:function(c,b){0===
c&&(c="0");var a,d,e=ya,f=this.getPath(c),k=A(f,!0),g=k.split(".");if(1===g.length)d=k;else{d=g[g.length-1];for(a=0;a<g.length-1&&!(e=e[g[a]],e===u);a++);}if(Y(e)){if(b)return;throw"invalid update on unreachable node '"+J(f)+"'";}return{physicalPath:k,hostObj:e,index:d}},create:function(c,b,a,d){W(c)||(d=a,a=b,b=c,c=!1);d=d||this.accessor(b);b=d.physicalPath;var e=d.hostObj,f=d.index,k=I(e);if(k&&za(f)){if(f>e.length)throw"you can not add item with hole in array";}else if(f in e)throw"value at path: '"+
J(d.physicalPath)+"' has been defined, try use update method instead";if(!c&&s(b,b,"beforeCreate",a).hasError())return!1;k&&za(f)?f==e.length?e[f]=a:f<e.length&&e.splice(d.index,0,a):e[d.index]=a;s(b,b,"afterCreate",a);pa(b,a);return this},extend:function(c,b){var a;b?a=this.cd(c):(b=c,a=this);for(var d in b)a.set(d,b[d]);return this},update:function(c,b,a,d){if(1==arguments.length){if(""===this.path)throw"root object can not updated";p.update(this.path,c);return this}if(W(c)){if(2==arguments.length)return p.update(c,
this.path,b),this}else d=a,a=b,b=c,c=!1;d=d||this.accessor(b);if(!(d.index in d.hostObj))throw"value at path: '"+J(d.physicalPath)+"' has been not defined, try use create method instead";var e=d.physicalPath,f=d.hostObj[d.index];if(f==a)return this;if(!c&&s(e,e,"beforeUpdate",a,f).hasError())return!1;d.hostObj[d.index]=a;c||s(e,e,"afterUpdate",a,f);pa(e,a);return this},del:function(c){if(j(c)){if(this.path)return p.del(this.path);throw"root can not be deleted";}var b=this.accessor(c),a=b.hostObj;
c=b.physicalPath;var d=a[b.index],e=I(a);if(s(c,c,"beforeDel",u,d).hasError())return!1;e?a.splice(b.index,1):delete a[b.index];for(b=0;b<ka.length;b++)ka[b](c,d);s(c,c,"afterDel",u,d);return d},createIfUndefined:function(c,b){if(j(b))throw"missing value argument";var a=this.accessor(c);return a.index in a.hostObj?this:this.create(c,b,a)},pushStack:function(c){c.previous=this;return c},cd:function(c){return this.pushStack(h(this.getPath(c)))},parent:function(){return this.cd("..")},shadow:function(){return this.cd("*")},
sibling:function(c){return this.cd(".."+c)},main:function(){return this.pushStack(h(Ea(this.path)))},getPath:function(c){return x(this.path,c)},logicalPath:function(c){return J(this.getPath(c))},physicalPath:function(c){return A(this.getPath(c))},pathContext:function(){return Ia(this.path)},pathIndex:function(){var c=sb.exec(this.path);return c[1]||c[0]},invoke:function(c){if(0===arguments.length)throw"methodName is missing";var b=this.get();return b[c].apply(b,r.call(arguments,1))},indexOf:function(c){return this.get().indexOf(c)},
contains:function(c){return-1!==this.indexOf(c)},first:function(c){return c?this.filter(c)[0]:this.get("0")},last:function(){var c=this.get();return c[c.length-1]},push:function(c){return this.create(this.get().length,c)},pushRange:function(c){for(var b=0;b<c.length;b++)this.push(c[b]);return this},pushUnique:function(c){return!this.contains(c)?this.push(c):this},pop:function(){return this.removeAt(this.get().length-1)},shift:function(){return this.del(0)},unshift:function(c){return this.create(0,
c)},insertAt:function(c,b){return this.create(c,b)},updateAt:function(c,b){return this.update(c,b)},removeAt:function(c){return this.del(c)},move:function(c,b){var a=this.count();c!==b&&(0<=c&&c<a&&0<=b&&b<a)&&(a=this.del(c),this.insertAt(b,a),s(this.path,this.path,"move",b,c));return this},replaceItem:function(c,b){if(c==b)return this;var a=this.indexOf(c);return-1!=a?this.updateAt(a,b):this},removeItem:function(c){c=this.indexOf(c);return-1!==c?this.removeAt(c):this},removeItems:function(c){for(var b=
0;b<c.length;b++)this.removeItem(c[b]);return this},clear:function(){var c=this.get(),b=c.splice(0,c.length);s(this.path,this.path,"afterCreate",c,b);return this},count:function(){return this.get().length},filter:function(c){return g(this.get()).filter(c).get()},each:function(c,b){W(c)||(b=c,c=!1);var a,d,e,f;if(c){f=this.get();for(d=f.length-1;0<=d;d--)if(e=b(d,f[d],f),!0===e)a=!0;else if(!1===e)break;a&&this.triggerChange()}else for(d=this.count()-1;0<=d&&!(a=this.cd(d),!1===b.call(a,d,a,this));d--);
return this},map:function(c){return g.map(this.get(),c)},sort:function(c,b){return s(this.path,this.path,"afterUpdate",this.get().sortObject(c,b))},reference:function(){for(var c=0;c<arguments.length;c++)Ga(this.path,arguments[c]);return this},dereference:function(){for(var c=0;c<arguments.length;c++)Ha(this.path,arguments[c]);return this},isEmpty:function(c){c=this.get(c);return!c?!0:!I(c)?!1:0===c.length},isShadow:function(){return this.path.startsWith(z)},toJSON:function(c){return JSON.stringify(this.get(c))},
compare:function(c){if(c)if(c=ja(c),l(c)){if(this.get()==c)return!0;try{return eval("this.get()"+c)}catch(b){return!1}}else return this.get()==c;else return this.isEmpty()},saveLocal:function(c){F.local(this.getPath(c),this.get());return this},getLocal:function(c){return F.local(this.getPath(c))},restoreLocal:function(c){p.set(this.getPath(c),this.getLocal(c));return this},clearLocal:function(c){F.local(this.getPath(c),u);return this}};var M=[function(c,b,a){if(n(a)&&(!a.name||!a.name.startsWith("_"))){b=
c?c+"."+b:b;var d=a.toString(),e;for(a=[];e=kb.exec(d);)a.pushUnique(e[2]);for(d=0;d<a.length;d++)Ga(b,c?x(c,a[d]):a[d])}}],P={},Aa=function b(a){var d;if(!(this instanceof b))return d=new b(P),b.apply(d,arguments);if(arguments[0]===P)return this;this.initialize.apply(this,arguments);return this},X;m(Aa.prototype,{callProto:function(b){return this.constructor.prototype[b].apply(this,r.call(arguments,1))},callBase:function(b){X=X||this;if(X=X.constructor.__super__){var a=X[b].apply(this,r.call(arguments,
1));X=null;return a}},initialize:function(b){m(this,b)},toJSON:function(){var b=m(!0,{},this),a;for(a in b)a.startsWith("__")&&delete b[a];return b}});m(Aa,{list:function(b){var a,d,e=[],f;if(!j(b))if(I(b)){f=b.itemIsObject;for(a=0;a<b.length;a++)d=b[a],e.push(f||!I(d)?new this(d):this.apply(null,d))}else e.push(b);return e},extend:function(b,a){var d,e=this;d=b&&b.hasOwnProperty("constructor")?b.constructor:function qa(){var a;if(!(this instanceof qa))return a=new qa(P),qa.apply(a,arguments);if(arguments[0]===
P)return this;e.apply(this,arguments);return this};m(d,e,a);var f=function(){this.constructor=d};f.prototype=e.prototype;d.prototype=new f;b&&m(d.prototype,b);d.__super__=e.prototype;return d}});m(h,{Class:Aa,util:F={toPhysicalPath:A=function(b,a){for(var d,e="",f="",k;d=qb.exec(b);)b=K.rightContext,f=K.leftContext,"."==d[0]?e?(e==z&&(a&&!ba[f])&&(k=f.replace(na,oa),j(p.get(k))||(ba[f]={})),e=e+"."+f):e=f:(e?(d=(e?e.replace(rb,cb):e)+"#"+f,k=e+"."+f):k=f?d=f:d="",e=z+(d?"."+d:""),a&&(!ba[d]&&e!=z&&
!j(p.get(k)))&&(ba[d]={}));return!b?e:e?e+"."+b:b},toLogicalPath:J=function(b){var a;return b===z?"*":(a=Fa.exec(b))?(b=K.rightContext,a=a[1].replace(na,oa),J(a+"*"+b)):b},mergePath:x=function(b,a,d){if("_"==a||"_"==b)return"_";b=A(b);if(!j(a)&&null!==a&&(a+="",a.startsWith("/")))return a.substr(1);j(d)&&(d=!0);d&&(a&&b&&!Xa.test(a))&&(a="."+a);if(!a||"."==a)return b;if(Xa.test(a)){if(d=ob.exec(a)){a=1+(d[1]?d[1].length:0);for(var e=K.rightContext;a;)b=Ia(b),a--;return e?b?b+d[2]+e:e:"*"===d[2]?b+
"*":b}if(d=pb.exec(a))return x(Ea(b),d[1])}else return a;return b+a},isUndefined:j=function(b){return b===u},isPrimitive:Y=function(b){return null===b||typeof b in jb},isString:l=function(b){return"string"===typeof b},isObject:t=function(b){return"object"===g.type(b)},isBoolean:W=function(b){return"boolean"===typeof b},toTypedValue:ja=function(b){if(l(b)){b=g.trim(b);try{b="true"===b?!0:"false"===b?!1:"null"===b?null:"undefined"===b?u:za(b)?parseFloat(b):nb.test(b)?g.parseJSON(b):b}catch(a){}}return b},
isPromise:Z=function(b){return!(!b||!b.promise||!b.done||!b.fail)},clearObj:Ya=function(b){if(Y(b))return null;for(var a in b)lb.call(b,a)&&(b[a]=Ya(b[a]));return b},clone:function(b,a){return Y(b)?b:I(b)?b.slice(0):n(b)?b:m(!!a,{},b)},local:function(b,a){if(1==arguments.length)return JSON.parse(xa.getItem(b));j(a)?xa.removeItem(b):xa.setItem(b,JSON.stringify(a))},toString:function(b){return null===b||b===u?"":""+b},encodeHtml:function(b){var a=aa.createElement("div");a.appendChild(aa.createTextNode(b));
return a.innerHTML},_referenceTable:D},onAddOrUpdateNode:function(b){return b?(M.push(b),this):M},onDeleteNode:function(b){return b?(ka.push(b),this):ka},options:H});var ka=[function(b){var a,d,e=J(b);for(a in D)Ha(b,a);for(a in D)a.startsWith(b)&&delete D[a];for(d in ba)b=z+"."+d,a=J(b),(a==e||a.startsWith(e+"*")||a.startsWith(e+"."))&&p.del(b)}];g(["get","set","del","extend"]).each(function(b,a){h[a]=function(){return p[a].apply(p,r.call(arguments))}});p=h();S.hmData=function(b,a){var d=this.data("hmData");
if(0===arguments.length)return d;if(1===arguments.length)return d&&d[b];j(d)&&this.data("hmData",d={});d[b]=a};var R,O=/[ ]+/,Na=/\*\.$/,fb=/\.|\*/g,y,ub=0,vb=/init(\d*)/,ga=["get","set","convert","finalize","initialize"];da.prototype={constructor:da,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=B},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=
B},stopCascade:function(){this.isCascadeStopped=B},error:function(){this.hasError=B},isCascadeStopped:ca,isPropagationStopped:ca,isImmediatePropagationStopped:ca,hasError:ca,level:0};s=function(b,a,d,e,f){e=new da(b,a,d,e,f);Ma(e);if(!e.isPropagationStopped()&&e.publisher.path){e.isDependent()&&(e.originalPublisher.path=e.publisher.path);do e.publisher.path=e.publisher.pathContext(),e.level++,e.type=e.originalType+"."+e.level,Ma(e);while(!e.isPropagationStopped()&&e.publisher.path)}e.type=d;e.originalPublisher.path=
a;e.publisher.path=b;return e};var Ba=function(b,a){l(b)&&(b=A(b));for(var d=[],e=0,f;e<L.length;e++)f=L[e],a(f,b)&&d.push(f);return d},L=[];y={getByPublisher:function(b){return Ba(b,function(a,b){return a.publisher==b})},getBySubscriber:function(b){return Ba(b,function(a,b){return a.subscriber==b})},getBy:function(b){return Ba(b,function(a,b){return a.subscriber==b||a.publisher==b})},getAll:function(){return L},add:function(b,a,d,e){if(l(a))for(var f=d.split(O),k=0;k<f.length;k++){var g=this.special[f[k]];
g&&g.setup&&g.setup(b,a)}L.push({publisher:a,subscriber:b,eventTypes:d,workflow:e})},removeBy:function(b){var a,d,e,f=[];for(a=L.length-1;0<=a;a--)if(e=L[a],d=e.workflow,b===e.publisher||b===e.subscriber||l(b)&&(l(e.publisher)&&e.publisher.startsWith(b+".")||l(e.subscriber)&&e.subscriber.startsWith(b+".")))l(e.publisher)||(d.delegateSelector?g(e.publisher).undelegate(d.delegateSelector,e.eventTypes,Q):g(e.publisher).unbind(e.eventTypes,Q)),f.push(L.splice(a,1)[0]);for(a=f.length-1;0<=a;a--)if(e=f[a],
l(e.publisher)){var k=e.eventTypes.split(O);for(b=0;b<k.length;b++)(d=this.special[k[b]])&&d.teardown&&d.teardown(e.subscriber,e.publisher)}},special:{}};m(h,{trigger:s,subscription:y,sub:function(b,a,d,e,f,k){b instanceof h&&(b=b.path);a instanceof h&&(a=a.path);l(b)&&b.startsWith("$")&&(b=g(b.substr(1)));if(b&&b.jquery)if(!b.length&&!b.selector)b=null;else{b.each(function(b,g){h.sub(g,a,d,e,f,k)});return}l(a)&&a.startsWith("$")&&(a=g(a.substr(1)));if(a&&a.jquery)a.each(function(a,g){h.sub(b,g,d,
e,f,k)});else{if(!a&&""!==a)throw"publisher can not be null";if(!d)throw"eventTypes can not be null";if("_"===b||"null"==b||null===b)b=P;"_"===f&&(f=u);var j=l(a),m=l(b);N.mark(a);N.mark(b);j&&(a=A(a));m&&(b=A(b));if(j){var p=a,n=d,r=b,j=f,v,s,t,q;q=n.split(" ");for(var w=0;w<q.length;w++)if(m=vb.exec(q[w])){s=q[w];v=+m[1];q.splice(w,1);n=q.join(" ");break}t=Oa(e,p,r,j);n&&y.add(r,p,n,t);s&&(n=function(){var a=new da(p,p,s);ea(E(r),t,a)},v?V(n,v):n())}else v=a,j=d,m=b,q=f,w=j.split(" "),w.contains("init")&&
(n=!0,j=w.remove("init").join(" ")),w=Oa(e,v,m,q),q={workflow:w,subscriber:m},j?(j=La(j,v,m),k?(w.delegateSelector=k,g(v).delegate(k,j,q,Q)):g(v).bind(j,q,Q),y.add(m,v,j,w),n&&(k?g(v).find(k).trigger(j):g(v).trigger(j))):n&&(g(v).one("init",q,Q),g(v).trigger("init"))}},handle:function(){return this.sub.apply(this,[null].concat(r.call(arguments)))},workflowType:function(b,a){if(t(b))for(var d in b)R[d]=Pa(b[d]);else return j(b)?R:j(a)?R[b]:R[b]=Pa(a)},activity:{initialize:{},get:{getMember:Ja,getOriginal:function(b){return b.originalPublisher.get()},
skipGet:B},set:{setMember:Ka,skipSet:g.noop},convert:{toString:F.toString,toTypedValue:F.toTypedValue,toNumber:function(b){return+b},toDate:function(b){return new Date(b)}},finalize:{}}});R={triggerChange:{get:function(b){p.triggerChange(b.workflow.options)}},saveLocal:{get:function(b){var a=b.publisher.path;V(function(){h(a).saveLocal()},1)}}};var N={getId:function(b){return g(b).hmData("viewId")},unMark:function(b){g(b).hmData("viewId",u)},mark:function(b){t(b)&&!g(b).hmData("viewId")&&g(b).hmData("viewId",
++ub)}};h.onDeleteNode(Qa);m(sa,{trigger:function(b,a,d,e){if(!arguments.length)throw"missing arguments";3>=arguments.length&&(e=d,d=a,a=b,b="");var f=this.physicalPath(b);s(f,f,a,d,e);return this},triggerChange:function(b){var a=this.physicalPath(b);b=this.get(b);s(a,a,"afterUpdate",b,b);return this},sub:function(b,a,d,e,f){h.sub(this.path,b,a,d,e,f);return this},handle:function(b,a,d,e){h.sub(null,this,b,a,d,e);return this},subBy:function(b,a,d,e,f){h.sub(b,this.path,a,d,e,f);return this},subsToMe:function(){return y.getByPublisher(this.path)},
subsFromMe:function(){return y.getBySubscriber(this.path)},subscriptions:function(){return y.getBy(this.path)},mapEvent:function(b,a,d){d=d||B;h.handle(this.path,b,function(b){d.call(this,b)&&b.publisher.trigger(a,b.proposed,b.removed)});return this},cacheable:function(b){h.handle(this.getPath(b),"init after*","*saveLocal");return this}});m(S,{sub:function(b,a,d,e,f){this.length&&h.sub(this,b,a,d,e,f);return this},handle:function(b,a,d,e){this.length&&h.sub(null,this,b,a,d,e);return this},subBy:function(b,
a,d,e,f){this.length&&h.sub(b,this,a,d,e,f);return this},subsToMe:function(){return y.getByPublisher(this[0])},subsFromMe:function(){return y.getBySubscriber(this[0])},subscriptions:function(){return y.getBy(this[0])},initView:function(b,a,d){h.sub(this,b,"init",a,d);return this},mapEvent:function(b,a,d,e){d?n(d)||(e=d,d=B):d=B;return this.handle(b,function(b){d.call(this,b)&&(b.type=a,b.eventData=e,b.publisher.trigger(b))})}});h.newViewEvent=function(b,a,d){if(t(b)){for(var e in b)h.newViewEvent(e,
b[e][0],b[e][1]);return this}var f=function(a){(!0===d||d.call(this,a))&&g(a.target).trigger(m({},a,{type:b,currentTarget:a.target}))};if(g.event.special[b])throw"event '"+b+"' has been defined";g.event.special[b]={setup:function(){g(this).bind(a,f)},teardown:function(){g(this).unbind(a,f)}};return this};var wb=g.cleanData;g.cleanData=function(b){g(b).each(function(){Qa(this)});wb(b)};F.getUniqueViewEventTypes=La;F._viewHandlerGateway=Q;var gb=/([!$]?)([\w \+\-\*\.]+?):([\w\W]+?)\s*(?:[;]\s*|$)/g,
xb=/^([^|]+)(\|(.*))?$/,yb=/\s*\|\s*/g;H.subsAttr="data-sub";H.autoparseSub=!0;G.prototype={importGroup:function(){var b,a,d,e,f=this.groups;for(b=0;b<f.length;b++)d=f[b],a=d.key,e=xb.exec(d.value),d=e[1],e=e[3],a=h.groups[a],n(a)?a(this.elem,x(this.ns,d),this,ta(this.options,e)):l(a)&&new G(a,this,d,e)},importSubscriptions:function(b){var a,d,e,f,g,h=this[b];for(a=0;a<h.length;a++)d=h[a],f=d.key,d=d.value.split(yb),"sub"==b?(e=d[0],e=e.startsWith("$")?e:x(this.ns,e),g=this.elem):(e=this.elem,g=d[0],
g=g.startsWith("$")?g:x(this.ns,g)),this.appendSub(g,e,f,d[1],ja(ta(this.options,d[2])),d[3])},appendSub:function(b,a,d,e,f,g){this.subscriptions.push({publisher:a,eventTypes:d,subscriber:b,handler:e,options:f,delegate:g})},prependSub:function(b,a,d,e,f,g){this.subscriptions.unshift({publisher:a,eventTypes:d,subscriber:b,handler:e,options:f,delegate:g})},clearSubs:function(){this.subscriptions.splice(0,this.subscriptions.length)}};V(function(){g(function(){H.autoparseSub&&ua(aa.documentElement)})},
1);S.parseSub=function(){return this.each(function(){ua(this)})};var Za=h("*log",[]);m(h,{groups:{code:function(b,a,d,e){p.get(a,b,a,d,e)},preSub:function(b,a,d,e){d.preSub=function(){p.get(a,b,a,d,e)}},postSub:function(b,a,d,e){d.postSub=function(){p.get(a,b,a,d,e)}}},Group:G,log:function(b,a){Za.push(a?"<div style='color:"+a+"'>"+b+"</div> ":b)},clearlog:function(){Za.clear()}});var T,ia={},va={initialize:"*templateOptions",get:"get",convert:"*dataToMarkup",set:"html",finalize:"*parseSub"};h.activity.initialize.templateOptions=
function(b,a,d,e){if(l(e))e=e.split(","),d.templateId=g.trim(e[0]),d.wrapDataInArray="true"==g.trim(e[1]),d.engineName=e[2];else if(t(e)&&e.templateId)m(d,e);else if(!(d.templateId=a.hmData("embeddedTemplate")))if(b=g.trim(a.html()))b=b.replace(zb,Ab),d.templateId="__"+g.uuid++,T.compile(d.templateId,b),a.hmData("embeddedTemplate",d.templateId),a.empty();else throw"missing template";};var zb=/&lt;|&gt;/g,Bb={"&lt;":"<","&gt;":">"},Ab=function(b){return Bb[b]||""};Sa.prototype.get=function(){var b=
this.e.publisher;return b.get.apply(b,r.call(arguments))};h.activity.convert.dataToMarkup=function(b,a){if(b&&(I(b)&&b.length||!I(b))){var d=a.workflow,e;var f=d.templateId,k=d.wrapDataInArray?[b]:b;e=new Sa(a);var h=Ta(d.engineName,f),f=g.trim(f);if(h.isTemplateLoaded(f))e=h.render(f,k,e);else if(h.renderAsync)e=h.renderAsync(f,k,e);else{var j=g.Deferred(),d=m(!0,{},e.e),n=m(!0,{},d.publisher),p=m(!0,{},e);d.publisher=n;p.e=d;T.load(f).done(function(){var a=h.render(f,k,p),b=g(a);j.resolve(b.selector||
!b.length?a:b)});e=j.promise()}if(Z(e))return e;l(e)&&(e=g.trim(e));return g(g("<div />").html(e)[0].childNodes)}return""};h.activity.finalize.parseSub=function(b){g(b).parseSub()};h.workflowType({renderContent:va,renderSelf:Ra("get","replaceWith")});m(h.groups,{"for":"!init:.|*renderContent",forSelf:"!init after*.:.|*renderContent",forChildren:"!init after*. after*.1:.|*renderContent",forAll:"!init after*:.|*renderContent",renderSelf:"!init:.|*renderSelf"});S.renderContent=function(b,a,d){a=a||"";
n(d)&&(d={finalize:d});return this.initView(a,d?m({},va,d):"*renderContent",b)};S.renderSelf=function(b,a,d){n(d)&&(d={finalize:d});return this.initView(a,d?m({},h.workflowType("renderSelf"),d):"*renderSelf",b)};h.template=T={defaultEngine:"",engineAdapter:function(b,a){if(!b)return ia;if(!a)return ia[b];a.isTemplateLoaded=a.isTemplateLoaded||B;ia[b]=a;T.defaultEngine=b},load:function(){throw"not implemented";},compile:function(b,a,d){return Ta(d).compile(b,a)},newTemplateWorkflow:Ra};if(g.render&&
g.templates){var Ca;T.engineAdapter("jsrender",Ca={render:function(b,a,d){g.render[b]||this.compile(b,aa.getElementById(b).innerHTML);return g.render[b](a,d)},compile:function(b,a){g.templates(b,{markup:a,debug:Ca.templateDebugMode,allowCode:Ca.allowCodeInTemplate})},isTemplateLoaded:function(b){return!!g.render[b]||!!aa.getElementById(b)},templateDebugMode:!1,allowCodeInTemplate:!0});var $a=g.views.tags;$a({ts:function a(){return a.enabled?"<span style='color:red' data-sub='show:/*ts'>updated on:"+
(+new Date+"").substring(7,10)+"</span>":""},indexToNs:function(){var a=this.tagCtx.view.index,d=this.ctx.modelPath;j(a)&&(a=this.ctx.e.publisher.count()-1);return"ns:/"+d+"."+a},get:function(){var a=this.ctx.e.publisher;return a.get.apply(a,r.call(arguments))},prop:function(){var a=this.tagCtx.view.index;j(a)&&(a=this.ctx.e.publisher.count()-1);a=this.ctx.e.publisher.cd(a);return a.get.apply(a,r.call(arguments))},keyToNs:function(){return"ns:/"+this.ctx.modelPath+".table."+this.ctx.e.publisher.itemKey(this.tagCtx.view.data)},
dataPathAsNs:function(){return"ns:/"+this.ctx.modelPath}});$a.ts.render.enabled=!0;h("*ts",!1)}var q=C.Handlebars;j(q)||(h.template.engineAdapter("handlebars",{render:function(a,d,e){return q.partials[a](d,{data:{renderContext:e}})},compile:function(a,d){q.registerPartial(a,q.compile(d))},isTemplateLoaded:function(a){return!!q.partials[a]}}),q.registerHelper("modelPath",function(a){return a.data.renderContext.modelPath}),q.registerHelper("indexToNs",function(a){return"ns:/"+a.data.renderContext.modelPath+
"."+a.data.index+";"}),q.registerHelper("keyToNs",function(a){a=a.data.renderContext;return"ns:/"+a.modelPath+".table."+a.e.publisher.itemKey(this)}),q.registerHelper("get",function(){var a=arguments,d=a.length-1,e=a[d].data.renderContext;return e.get.apply(e,r.call(a,0,d))}),q.registerHelper("prop",function(){var a=[].slice,d=arguments,e=d.length-1,f=d[e].data,f=f.renderContext.e.publisher.cd(f.index);return f.get.apply(f,a.call(d,0,e))}),g(function(){g("script[type=handlebars]").each(function(){q.registerPartial(this.id,
q.compile(g(this)[0].innerHTML))})}));var U=[{name:"textBoxOrDropDown",get:function(a){return a.val()},set:function(a,d){a.val()!==d&&a.val(d)},match:B},{name:"checkbox",get:Ua,set:function(a,d){var e=a[0];e.checked=W(d)?d:d==e.value},match:function(a){return a.is(":checkbox")}},{name:"radio",get:Ua,set:function(a,d,e){a=a[0];a.name||(a.name=e.publisher.path);a.checked=F.toString(d)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",get:function(a){var d=[];a.children("option:selected").each(function(){d.push(this.value)});
return d},set:function(a,d){function e(){this.value==g&&(this.selected=!0)}a.children("option:selected").removeAttr("selected");for(var f=0,g;f<d.length;f++)g=d[f],a.children("option").each(e)},match:function(a){return a.is("select[multiple]")}}];h.activity.get.getViewValue=function(a){return a.workflow.getViewValue(a.publisher)};h.activity.set.setViewValue=function(a,d){return d.workflow.setViewValue(this,a,d)};h.workflowType({updateViewValue:{initialize:function(a,d,e,f){Va(d,e,f,"set")},get:"get",
set:"*setViewValue"},updateModelValue:{initialize:function(a,d,e,f){Va(a,e,f,"get")},get:"*getViewValue",set:"set"}});h.valueAdapter=function(a){if(a)U.push(a);else return U};h.groups.val=function(a,d,e,f){var g,h,j;(f=f||"")?(f=f.split(","),h=f[0]||"change",g=f[1],j=f[2]):h="change";(!g||"updateView"==g)&&e.appendSub(a,d,"init1 after*","*updateViewValue",j);(!g||"updateModel"==g)&&e.appendSub(d,a,h+" resetVal","*updateModelValue",j)};h.groups.resetFormValues=function(a){function d(){e.find(":input").trigger("resetVal")}
var e=g(a);e.bind("reset",function(){V(d,1)})};H.confirmMessage="Are you sure?";h.activity.get.compareTruthy=function(a){var d=a.workflow.options;a=a.publisher;return j(d)?!a.isEmpty():a.compare(d)};h.activity.initialize.extractClass=function(a,d,e,f){a=f.split(",");e.className=a[0];e.options=a[1]};var ab={options:["!init after*:.|*options",{get:function(a){var d=a.workflow.options,e=this.val();this.children("option[listItem]").remove().end().append(function(){var e="";g(a.publisher.get()).each(function(){e+=
"<option listItem='1' value='"+d.value(this)+"'>"+d.name(this)+"</option>"});return e}).val(e);this.val()!==e&&g(this.trigger("change"))},initialize:function(a,d,e,f){if(f){a=f.split(",");var g=a[0],h=a[1]||a[0];e.options={name:function(a){return a[g]},value:function(a){return a[h]}}}else e.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}}],show:["!init after*:.|*show",{get:"*compareTruthy",set:function(a){this[a?"show":"hide"]()}}],hide:["!init after*:.|*hide",
{get:"*compareTruthy",set:function(a){this[a?"hide":"show"]()}}],enable:["!init after*:.|*enable",{get:"*compareTruthy",set:function(a){this.attr("disabled",!a)}}],disable:["!init after*:.|*disable",{get:"*compareTruthy",set:function(a){this.attr("disabled",a)}}],addClass:["!init after*:.|*addClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,d){this[a?"addClass":"removeClass"](d.workflow.className)}}],removeClass:["!init after*:.|*removeClass",{initialize:"*extractClass",get:"*compareTruthy",
set:function(a,d){this[a?"removeClass":"addClass"](d.workflow.className)}}],toggleClass:["!init after*:.|*toggleClass",{get:function(a){var d,e,f=a.publisher.get(),g=a.workflow.options;g&&(g.startsWith("!")&&(e=!0,g=g.substr(1)),d=f^e?"addClass":"removeClass");if("init"==a.type)if(g)this[d](g);else this.addClass(f);else if(g)this[d](g);else this.removeClass(a.removed).addClass(f)}}],focus:["!init after*:.|*focus",{get:"*compareTruthy",set:function(a){if(a){var d=this;V(function(){d.focus().select()},
1)}}}],count:["!init after*:.|*count",function(a){a=a.publisher.get();this.text("length"in a?a.length:a)}],dump:["!init *:.|*dump",function(a){a.type.startsWith("before")||this.html("<span style='color:red'>"+a.publisher.path+" : "+a.publisher.toJSON()+"</span>")}],alert:["$click:.|*alert",function(a){hb(j(a.workflow.options)?this.get():a.workflow.options)}],preventDefault:["$click:_|*preventDefault",function(a){a.preventDefault()}],stopPropagation:["$click:_|*stopPropagation",function(a){a.stopPropagation()}],
confirm:[function(a,d,e,f){h.sub(d,a,"click","*confirm",f)},function(a){var d=j(a.workflow.options)?this&&this.get&&this.get()||H.confirmMessage:a.workflow.options;ib(d)||(a.stopImmediatePropagation(),a.preventDefault&&a.preventDefault())}],hardCode:["$click:.|*hardCode",{initialize:function(a,d,e,f){e.hardCode=ja(f)},get:function(a){this.set(a.workflow.hardCode)}}],"0":["$click:.|*0",function(){this.set(0)}],emptyString:["$click:.|*empty",function(){this.set("")}],"null":["$click:.|*null",function(){this.set(null)}],
"true":["$click:.|*true",function(){this.set(!0)}],"++":["$click:.|*++",function(){this.set(this.get()+1)}],"--":["$click:.|*--",function(){this.set(this.get()-1)}],"false":["$click:.|*false",function(){this.set(!1)}],toggle:["$click:.|*toggle",function(){this.set(!this.get())}],sortItems:["$click:.|*sortItems",{initialize:function(a,d,e,f){f=(f||"")&&f.split(",");e.by=f[0];e.asc=!!f[1]},get:function(a){a=a.workflow;this.sort(a.by,a.asc);a.asc=!a.asc}}],clear:["$click:.|*clear",function(){this.clear()}],
del:["$click:.|*del;confirm:_|_Do you want to delete this item?",function(){this.del()}]},la;for(la in ab){var bb=ab[la];h.groups[la]=bb[0];h.workflowType(la,bb[1])}m(h.groups,{caption:function(a,d,e,f){g(a).prepend("<option value=''>"+(f||h.get(d))+"</option>")},autofocus:function(a){V(function(){g(a).focus()},1)},mapEvent:function(a,d,e,f){f=f.split(",");g(a).mapEvent(f[0],f[1],f[2])},mapClick:function(a,d,e,f){f=f.split(",");g(a).mapEvent("click",f[0],f[1])},logPanel:function(a,d,e){a=g(a);var f=
a.is("ol")?a:g("<ol style='font-family: monospace, serif' />").appendTo(a);a=f[0];e.appendSub(a,"*log","init",function(a){a=a.publisher.get();for(var d=0;d<a.length;d++)f.append("<li>"+a[d]+"</li>")});e.appendSub(a,"*log","afterCreate.1",function(a){f.append("<li>"+a.originalPublisher.raw()+"</li>")});e.appendSub(a,"*log","afterCreate",function(){f.empty()})},clearlog:"clear:/*log",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString"});
h.newViewEvent({enter:["keyup",function(a){return 13===a.keyCode}],esc:["keyup",function(a){return 27===a.keyCode}],ctrlclick:["click",function(a){return a.ctrlKey}]})})(jQuery,window);
